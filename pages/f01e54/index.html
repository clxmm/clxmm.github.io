<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>03redis事务和管道 | clxmm</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/icon.jpeg">
    <meta name="description" content="111">
    <meta name="keywords" content="clxmm">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.91c54501.css" as="style"><link rel="preload" href="/assets/js/app.5310cdc4.js" as="script"><link rel="preload" href="/assets/js/2.c9184447.js" as="script"><link rel="preload" href="/assets/js/3.b86c239d.js" as="script"><link rel="preload" href="/assets/js/13.607f8a97.js" as="script"><link rel="prefetch" href="/assets/js/10.3bb44866.js"><link rel="prefetch" href="/assets/js/11.f29116e0.js"><link rel="prefetch" href="/assets/js/12.eaa80fe1.js"><link rel="prefetch" href="/assets/js/14.715b1c48.js"><link rel="prefetch" href="/assets/js/15.71d2dbc1.js"><link rel="prefetch" href="/assets/js/16.b263764f.js"><link rel="prefetch" href="/assets/js/17.7201f4e6.js"><link rel="prefetch" href="/assets/js/18.94bf12e5.js"><link rel="prefetch" href="/assets/js/19.416a156a.js"><link rel="prefetch" href="/assets/js/20.33931d01.js"><link rel="prefetch" href="/assets/js/21.8e58e1f5.js"><link rel="prefetch" href="/assets/js/22.e5a8bb91.js"><link rel="prefetch" href="/assets/js/23.b24b112f.js"><link rel="prefetch" href="/assets/js/24.98b533de.js"><link rel="prefetch" href="/assets/js/25.0bc0ae20.js"><link rel="prefetch" href="/assets/js/26.2c564d65.js"><link rel="prefetch" href="/assets/js/27.b1757049.js"><link rel="prefetch" href="/assets/js/28.1cc196ce.js"><link rel="prefetch" href="/assets/js/29.86f67f48.js"><link rel="prefetch" href="/assets/js/30.c88df1af.js"><link rel="prefetch" href="/assets/js/31.0374d8b8.js"><link rel="prefetch" href="/assets/js/32.caf9bf23.js"><link rel="prefetch" href="/assets/js/33.c1da0085.js"><link rel="prefetch" href="/assets/js/34.1f76479f.js"><link rel="prefetch" href="/assets/js/35.32aa3010.js"><link rel="prefetch" href="/assets/js/36.3dbaf336.js"><link rel="prefetch" href="/assets/js/37.232d9208.js"><link rel="prefetch" href="/assets/js/38.29f11a39.js"><link rel="prefetch" href="/assets/js/39.c83c649b.js"><link rel="prefetch" href="/assets/js/4.f96b24c5.js"><link rel="prefetch" href="/assets/js/40.713de3d2.js"><link rel="prefetch" href="/assets/js/41.4638cde0.js"><link rel="prefetch" href="/assets/js/5.2e4cbb9e.js"><link rel="prefetch" href="/assets/js/6.7b582dbb.js"><link rel="prefetch" href="/assets/js/7.ac6d362f.js"><link rel="prefetch" href="/assets/js/8.e1180ebd.js"><link rel="prefetch" href="/assets/js/9.058f530e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.91c54501.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">clxmm</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端学习" class="dropdown-title"><a href="/java/" class="link-title">后端学习</a> <span class="title" style="display:none;">后端学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>01redis学习</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/356b54/" class="nav-link">01redis开始</a></li></ul></li><li class="dropdown-item"><h4>02redis学习</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/356b51/" class="nav-link">01redis开始</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端学习" class="dropdown-title"><a href="/web/" class="link-title">前端学习</a> <span class="title" style="display:none;">前端学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>vue2学习</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/7f2831/" class="nav-link">01vue学习</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/other/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>centos安装zsh</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/435ca7/" class="nav-link">centos安装zsh</a></li></ul></li></ul></div></div> <a href="https://github.com/clxmm/clxmm" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端学习" class="dropdown-title"><a href="/java/" class="link-title">后端学习</a> <span class="title" style="display:none;">后端学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>01redis学习</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/356b54/" class="nav-link">01redis开始</a></li></ul></li><li class="dropdown-item"><h4>02redis学习</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/356b51/" class="nav-link">01redis开始</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端学习" class="dropdown-title"><a href="/web/" class="link-title">前端学习</a> <span class="title" style="display:none;">前端学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>vue2学习</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/7f2831/" class="nav-link">01vue学习</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/other/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>centos安装zsh</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/435ca7/" class="nav-link">centos安装zsh</a></li></ul></li></ul></div></div> <a href="https://github.com/clxmm/clxmm" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>redis</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/356b54/" class="sidebar-link">01redis</a></li><li><a href="/pages/2a37ab/" class="sidebar-link">02redis持久化</a></li><li><a href="/pages/f01e54/" aria-current="page" class="active sidebar-link">03redis事务和管道</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/f01e54/#_1-是什么" class="sidebar-link">1.是什么</a></li><li class="sidebar-sub-header level2"><a href="/pages/f01e54/#_2-能干什么" class="sidebar-link">2.能干什么</a></li><li class="sidebar-sub-header level2"><a href="/pages/f01e54/#_3-redis事务-vs-数据库事务" class="sidebar-link">3.Redis事务 VS 数据库事务</a></li><li class="sidebar-sub-header level2"><a href="/pages/f01e54/#_4-如何使用" class="sidebar-link">4.如何使用</a></li><li class="sidebar-sub-header level2"><a href="/pages/f01e54/#_5-总结" class="sidebar-link">5. 总结</a></li><li class="sidebar-sub-header level2"><a href="/pages/f01e54/#问题" class="sidebar-link">问题</a></li><li class="sidebar-sub-header level2"><a href="/pages/f01e54/#_1-定义" class="sidebar-link">1.定义</a></li><li class="sidebar-sub-header level2"><a href="/pages/f01e54/#_2-演示" class="sidebar-link">2.演示</a></li><li class="sidebar-sub-header level2"><a href="/pages/f01e54/#_3-总结" class="sidebar-link">3.总结</a></li></ul></li><li><a href="/pages/75cece/" class="sidebar-link">04redis发布与订阅</a></li><li><a href="/pages/4a54cc/" class="sidebar-link">05Redis复制(replica)</a></li><li><a href="/pages/9788da/" class="sidebar-link">06Redis哨兵(sentinel)</a></li><li><a href="/pages/551b67/" class="sidebar-link">07Redis集群(cluster)</a></li><li><a href="/pages/ebe3c7/" class="sidebar-link">08redis与SpringBoot集成</a></li><li><a href="/pages/fa5943/" class="sidebar-link">redis单线程与多线程</a></li><li><a href="/pages/ec796f/" class="sidebar-link">redis的BigKey</a></li><li><a href="/pages/e53d85/" class="sidebar-link">redis缓存双写一致性</a></li><li><a href="/pages/a32a66/" class="sidebar-link">12redis与mysql双写一致性</a></li><li><a href="/pages/8249db/" class="sidebar-link">13案列bitmap-hyperlog-geo</a></li><li><a href="/pages/d7b34c/" class="sidebar-link">14布隆过滤器BloomFilter</a></li><li><a href="/pages/cdc2c8/" class="sidebar-link">缓存预热、雪崩、击穿、穿透</a></li><li><a href="/pages/6b15da/" class="sidebar-link">redis的分布式锁</a></li><li><a href="/pages/6be928/" class="sidebar-link">17Redlock算法和缓存淘汰</a></li><li><a href="/pages/086c39/" class="sidebar-link">18Redis源码</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>redis02</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06970110><div class="articleInfo" data-v-06970110><ul class="breadcrumbs" data-v-06970110><li data-v-06970110><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06970110></a></li> <li data-v-06970110><a href="/java/#后端学习" data-v-06970110>后端学习</a></li><li data-v-06970110><a href="/java/#redis" data-v-06970110>redis</a></li></ul> <div class="info" data-v-06970110><div title="作者" class="author iconfont icon-touxiang" data-v-06970110><a href="https://github.com/clxmm" target="_blank" title="作者" class="beLink" data-v-06970110>clxmm</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06970110><a href="javascript:;" data-v-06970110>2024-08-16</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><!---->03redis事务和管道<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="redis事务"><a href="#redis事务" class="header-anchor">#</a> <strong>redis事务</strong></h1> <h2 id="_1-是什么"><a href="#_1-是什么" class="header-anchor">#</a> 1.是什么</h2> <p>可以一次执行多个命令，本质是一组命令的集合。一个事务中的所有命令都会序列化，<strong>按顺序地串行化执行而不会被其它命令插入，不许加塞</strong></p> <h2 id="_2-能干什么"><a href="#_2-能干什么" class="header-anchor">#</a> 2.能干什么</h2> <p><strong>一个队列中，一次性、顺序性、排他性的执行一系列命令</strong></p> <h2 id="_3-redis事务-vs-数据库事务"><a href="#_3-redis事务-vs-数据库事务" class="header-anchor">#</a> 3.Redis事务 VS 数据库事务</h2> <table><thead><tr><th>1 单独的隔离操作</th> <th>Redis的事务仅仅是保证事务里的操作会被连续独占的执行，redis命令执行是单线程架构，在执行完事务内所有指令前是不可能再去同时执行其他客户端的请求的</th></tr></thead> <tbody><tr><td>2 没有隔离级别的概念</td> <td>因为事务提交前任何指令都不会被实际执行，也就不存在”事务内的查询要看到事务里的更新，在事务外查询不能看到”这种问题了</td></tr> <tr><td>3不保证原子性</td> <td>不保证原子性，也就是不保证所有指令同时成功或同时失败，只有决定是否开始执行全部指令的能力，没有执行到一半进行回滚的能力</td></tr> <tr><td>4 排它性</td> <td>Redis会保证一个事务内的命令依次执行，而不会被其它命令插入</td></tr></tbody></table> <h2 id="_4-如何使用"><a href="#_4-如何使用" class="header-anchor">#</a> 4.如何使用</h2> <p><strong>常用命令</strong></p> <p><a href="https://www.runoob.com/redis/redis-transactions.html" target="_blank" rel="noopener noreferrer">Redis 事务 | 菜鸟教程 (runoob.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>常见操作</strong></p> <ul><li><p>case1：正常执行</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> MULTI
OK
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> k1 v1
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> k2 v2
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> k3 v3
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> INCR count
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> EXEC
<span class="token number">1</span><span class="token punctuation">)</span> OK
<span class="token number">2</span><span class="token punctuation">)</span> OK
<span class="token number">3</span><span class="token punctuation">)</span> OK
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get k3
<span class="token string">&quot;v3&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li> <li><p>case2:放弃执行</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> MULTI
OK
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> k3 v3
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> INCR count
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> DISCARD
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get k3
<span class="token string">&quot;v3&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get count
<span class="token string">&quot;1&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li> <li><p>case3: 全体连坐-全部失败</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> MULTI
OK
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> k2 v2
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> k2 v2
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> k3
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR wrong number of arguments <span class="token keyword">for</span> <span class="token string">'set'</span> <span class="token builtin class-name">command</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> EXEC
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> EXECABORT Transaction discarded because of previous errors.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>case4：冤头债主-成功的成功，失败的失败</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> email <span class="token number">123</span>@qq.com
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> MULTI
OK
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> k1 v1
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> INCR email
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> INCR count
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> EXEC
<span class="token number">1</span><span class="token punctuation">)</span> OK
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR value is not an integer or out of range
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>case5：watch监控</p> <ul><li><p>Redis使用Watch来提供乐观锁定，类似于CAS(Check-and-Set)</p> <ul><li>悲观锁： 悲观锁(Pessimistic Lock), 顾名思义，就是很悲观，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会block直到它拿到锁。</li> <li>乐观锁： 乐观锁(Optimistic Lock), 顾名思义，就是很乐观，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据。乐观锁策略:提交版本必须  大于  记录当前版本才能执行更新</li> <li>CAS：</li></ul></li> <li><p>watch：</p> <ul><li><p>正常情况下：初始化k1和balance两个key,先监控再开启multi，保证两key变动在同一个事务内</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k1 abc
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> balance <span class="token number">100</span>
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> WATCH balance
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> MULTI
OK
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> k1 abc2
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> balance <span class="token number">110</span>
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> EXEC
<span class="token number">1</span><span class="token punctuation">)</span> OK
<span class="token number">2</span><span class="token punctuation">)</span> OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get k1
<span class="token string">&quot;abc2&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get balance
<span class="token string">&quot;110&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></li> <li><p>监控的数据被修改：</p> <p><strong>watch命令是一种乐观锁的实现，Redis在修改的时候会检测数据是否被更改，如果更改了，则执行失败</strong></p> <p><strong>第一个窗口蓝色框第5步执行结果返回为空，也就是相当于是失败，笔记见最下面官网说明</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/redi-sw202408162310431.png" alt=""></p></li></ul></li> <li><p>unwatch：</p></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/redis202408162311820.png" alt=""></p> <h2 id="_5-总结"><a href="#_5-总结" class="header-anchor">#</a> 5. 总结</h2> <ul><li>开启：以MULTI开始一个事务</li> <li>入队：将多个命令入队到事务中，接到这些命令并不会立即执行，</li> <li>执行：由EXEC命令触发事务</li></ul></li></ul> <h1 id="redis-管道"><a href="#redis-管道" class="header-anchor">#</a> redis 管道</h1> <h2 id="问题"><a href="#问题" class="header-anchor">#</a> 问题</h2> <p>如何优化频繁命令往返造成的性能瓶颈？</p> <p><strong>问题由来</strong></p> <p>Redis是一种基于客户端-服务端模型以及请求/响应协议的TCP服务。一个请求会遵循以下步骤：</p> <ul><li>1 客户端向服务端发送命令分四步(发送命令→命令排队→命令执行→返回结果)，并监听Socket返回，通常以阻塞模式等待服务端响应。</li> <li>2 服务端处理命令，并将结果返回给客户端。</li></ul> <p><strong>上述两步称为：Round Trip Time(简称RTT,数据包往返于两端的时间)，问题笔记最下方</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/redis202408192135230.png" alt=""></p> <p>如果同时需要执行大量的命令，那么就要等待上一条命令应答后再执行，这中间不仅仅多了RTT（Round Time Trip），而且还频繁调用系统IO，发送网络请求，同时需要redis调用多次read()和write()系统方法，系统方法会将数据从用户态转移到内核态，这样就会对进程上下文有比较大的影响了，性能不太好，o(╥﹏╥)o</p> <h2 id="_1-定义"><a href="#_1-定义" class="header-anchor">#</a> 1.定义</h2> <p>管道(pipeline)可以一次性发送多条命令给服务端，服务端依次处理完完毕后，通过一条响应一次性将结果返回，通过减少客户端与redis的通信次数来实现降低往返延时时间。pipeline实现的原理是队列，先进先出特性就保证数据的顺序性。</p> <img src="https://cdn.jsdelivr.net/gh/clxmm/image/img/2024/08/redis-piple202408192136138.png" style="zoom:67%;"> <p>Pipeline是为了解决RTT往返回时，仅仅是将命令打包一次性发送，对整个Redis的执行不造成其它任何影响</p> <p><strong>批处理命令变种优化措施</strong>，，类似Redis的原生批命令(mget和mset)</p> <h2 id="_2-演示"><a href="#_2-演示" class="header-anchor">#</a> 2.演示</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>
<span class="token punctuation">[</span>root@localhost redis-7.0.0<span class="token punctuation">]</span><span class="token comment"># cat cmd.txt</span>
<span class="token builtin class-name">set</span> k1 v100
<span class="token builtin class-name">set</span> k2 v200
hset k3 name zs
hset k3 age <span class="token number">18</span>
lpush liset1 <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span>
<span class="token punctuation">[</span>root@localhost redis-7.0.0<span class="token punctuation">]</span><span class="token comment"># cat cmd.txt | ./src/redis-cli -a 123456abc --pip</span>
Unrecognized option or bad number of args for: <span class="token string">'--pip'</span>
<span class="token punctuation">[</span>root@localhost redis-7.0.0<span class="token punctuation">]</span><span class="token comment"># cat cmd.txt | ./src/redis-cli -a 123456abc --pipe</span>
Warning: Using a password with <span class="token string">'-a'</span> or <span class="token string">'-u'</span> option on the <span class="token builtin class-name">command</span> line interface may not be safe.
All data transferred. Waiting <span class="token keyword">for</span> the last reply<span class="token punctuation">..</span>.
Last reply received from server.
errors: <span class="token number">0</span>, replies: <span class="token number">5</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="_3-总结"><a href="#_3-总结" class="header-anchor">#</a> 3.总结</h2> <ul><li>Pipeline与原生批量命令对比
<ul><li>原生批量命令是原子性(例如:mset, mget)，<strong>pipeline是非原子性</strong></li> <li>原生批量命令一次只能执行一种命令，pipeline支持批量执行不同命令</li> <li>原生批命令是服务端实现，而pipeline需要服务端与客户端共同完成</li></ul></li> <li>Pipeline与事务对比
<ul><li>事务具有原子性，管道不具有原子性</li> <li>管道一次性将多条命令发送到服务器，事务是一条一条的发，事务只有在接收到exec命令后才会执行，管道不会</li> <li>执行事务时会阻塞其他命令的执行，而执行管道中的命令时不会</li></ul></li> <li>使用Pipeline注意事项
<ul><li>pipeline缓冲的指令只是会依次执行，不保证原子性，如果执行中指令发生异常，将会继续执行后续的指令</li> <li>使用pipeline组装的命令个数不能太多，不然数据量过大客户端阻塞的时间可能过久，同时服务端此时也被迫回复一个队列答复，占用很多内存</li></ul></li></ul></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/clxmm/clxmm/edit/master/docs/01.后端学习/10.redis/03.redis事务.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=redis" title="标签">#redis</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/08/19, 22:18:15</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/2a37ab/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">02redis持久化</div></a> <a href="/pages/75cece/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">04redis发布与订阅</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/2a37ab/" class="prev">02redis持久化</a></span> <span class="next"><a href="/pages/75cece/">04redis发布与订阅</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/5d8882/"><div>
            vue3
            <!----></div></a> <span class="date">02-08</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/5f5ab3/"><div>
            vue3-1
            <!----></div></a> <span class="date">01-24</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/7908dd/"><div>
            vue3
            <!----></div></a> <span class="date">01-18</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2024-2025
    <span>Evan Xu | <a href="https://github.com/clxmm" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5310cdc4.js" defer></script><script src="/assets/js/2.c9184447.js" defer></script><script src="/assets/js/3.b86c239d.js" defer></script><script src="/assets/js/13.607f8a97.js" defer></script>
  </body>
</html>
